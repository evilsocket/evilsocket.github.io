<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Process Introspection for Fun and Profit | evilsocket</title>
<meta name="description" content="While studying Windows internals for my job, I had to  deepen my knowledge of executable loading process, including their memory layout, address relocations and">


  <link rel="alternate" href="/atom.xml" title="evilsocket" type="application/atom+xml">


<link rel="icon" href="/images/favicon.ico">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="Process Introspection for Fun and Profit">
<meta property="og:description" content="While studying Windows internals for my job, I had to  deepen my knowledge of executable loading process, including their memory layout, address relocations and">
<meta property="og:url" content="/2014/02/02/Process-introspection-for-fun-and-profit/">
<meta property="og:site_name" content="evilsocket">

  
  
    <meta property="og:image" content="/images/default-cover.svg">
  


<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Process Introspection for Fun and Profit">
<meta name="twitter:description" content="While studying Windows internals for my job, I had to  deepen my knowledge of executable loading process, including their memory layout, address relocations and">

<!-- Schema.org JSON-LD -->


<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.evilsocket.net/2014/02/02/Process-introspection-for-fun-and-profit/"},"headline":"Process Introspection for Fun and Profit","description":"While studying Windows internals for my job, I had to deepen my knowledge of executable loading process, including their memory layout, address relocations and ","image":"https://www.evilsocket.net/images/default-cover.svg","datePublished":"2014-02-02T02:17:24.000Z","dateModified":"2014-02-03T13:26:14.000Z","author":{"@type":"Person","name":"Simone Margaritelli","description":"Italian cybersecurity researcher and open-source developer","url":"https://www.evilsocket.net","sameAs":["https://github.com/evilsocket","https://twitter.com/evilsocket","http://it.linkedin.com/in/simonemargaritelli/"],"jobTitle":"Security Researcher","worksFor":{"@type":"Organization","name":"Independent"}},"publisher":{"@type":"Organization","name":"evilsocket","url":"https://www.evilsocket.net","logo":{"@type":"ImageObject","url":"https://www.evilsocket.net/images/glider.png"}},"keywords":"hooking, api hooking, binary analysis, emulator, malware, win32, windows internals, tib, process environment block, ldr, loader, pe, vm, evasion, anti-debugging, sandbox detection","articleSection":"Technology","inLanguage":"en"}
</script>


<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="/css/style.css">


<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-22026549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-22026549-1');
</script>


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="post-page">
  <header class="site-header">
  <div class="header-inner">
    <div class="site-branding">
      <a href="/" class="site-logo">
        
          <img src="/images/glider.png" alt="evilsocket" width="50" height="50">
        
        <div class="site-title-group">
          <span class="site-title">evilsocket</span>
          <span class="site-motto">Preoccupied with a single leaf, you won't see the tree. Preoccupied with a single tree... you'll miss the entire forest.</span>
        </div>
      </a>
    </div>
    
    <nav class="site-nav">
      
        <a href="/" class="nav-link">
          HOME
        </a>
      
        <a href="/atom.xml" class="nav-link">
          RSS
        </a>
      
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <article class="post-full">
  <header class="post-header">
    <h1 class="post-title">Process Introspection for Fun and Profit</h1>
    <div class="post-meta">
      BY <span class="post-author">Simone Margaritelli</span>
      — <time datetime="2014-02-02T02:17:24.000Z">2 Feb 2014</time>
      
        — <a href="/tags/hooking/" class="post-category">hooking</a>, <a href="/tags/api-hooking/" class="post-category">api hooking</a>, <a href="/tags/binary-analysis/" class="post-category">binary analysis</a>, <a href="/tags/emulator/" class="post-category">emulator</a>, <a href="/tags/malware/" class="post-category">malware</a>, <a href="/tags/win32/" class="post-category">win32</a>, <a href="/tags/windows-internals/" class="post-category">windows internals</a>, <a href="/tags/tib/" class="post-category">tib</a>, <a href="/tags/process-environment-block/" class="post-category">process environment block</a>, <a href="/tags/ldr/" class="post-category">ldr</a>, <a href="/tags/loader/" class="post-category">loader</a>, <a href="/tags/pe/" class="post-category">pe</a>, <a href="/tags/vm/" class="post-category">vm</a>, <a href="/tags/evasion/" class="post-category">evasion</a>, <a href="/tags/anti-debugging/" class="post-category">anti-debugging</a>, <a href="/tags/sandbox-detection/" class="post-category">sandbox detection</a>
      
    </div>
  </header>

  <div class="post-content">
    <p>While studying Windows internals for my job, I had to  deepen my knowledge of executable loading process, including their memory layout, address relocations and so on.<br>I came accross the <strong>PEB</strong> ( process environment block ), a data structure ( mostly undocumented ) that NT systems use internally to handle many aspects of a process, including a list of loaded libraries, environment variables, command line arguments, heap informations, TLS slots and so on.<br>The interesting fact about the PEB is that can be inspected to obtain those informations without the use of any standard API, thus resulting in an interesting technique to detect bad written virtual machines, emulators and any sort of sandboxing that could be used by a malware analyst or an anti virus product.<br>Moreover you could check the PEB to detect if a DLL has been injected into your process to perform api hooking.<br>API hooking softwares usually hooks API such as <strong>EnumProcessModules</strong> and patch them to hide the presence of the injected module. Inspecting the PEB you will be able to perform the same task only analyzing your address space, thus avoiding API patching.</p>
<span id="more"></span>

<p>The address of the structure in our process virtual memory can be obtained with the <strong>NtQueryInformationProcess</strong> API, once you have the address you can cast it to a pointer to the following type.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">PEB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  BYTE                    InheritedAddressSpace;</span><br><span class="line">  BYTE                    ReadImageFileExecOptions;</span><br><span class="line">  BYTE                    BeingDebugged;</span><br><span class="line">  BYTE                    Spare;</span><br><span class="line">  DWORD                   dwMutant;                              </span><br><span class="line">  DWORD                   dwImageBaseAddress;                                                      </span><br><span class="line">  PEB_LDR_DATA*           LoaderData;                                                                      </span><br><span class="line">  DWORD                   dwProcessParameters;                                                </span><br><span class="line">  DWORD                   dwSubSystemData;                     </span><br><span class="line">  DWORD                   dwProcessHeap;                       </span><br><span class="line">  DWORD                   dwFastPebLock;                       </span><br><span class="line">  DWORD                   dwFastPebLockRoutine;                </span><br><span class="line">  DWORD                   dwFastPebUnlockRoutine;              </span><br><span class="line">  DWORD                   dwEnvironmentUpdateCount;            </span><br><span class="line">  DWORD                   dwKernelCallbackTable;               </span><br><span class="line">  DWORD                   dwEventLogSection;                   </span><br><span class="line">  DWORD                   dwEventLog;                          </span><br><span class="line">  DWORD                   dwFreeList;                          </span><br><span class="line">  DWORD                   dwTlsExpansionCounter;               </span><br><span class="line">  DWORD                   dwTlsBitmap;                         </span><br><span class="line">  DWORD                   dwTlsBitmapBits[<span class="number">0x2</span>];</span><br><span class="line">  DWORD                   dwReadOnlySharedMemoryBase;</span><br><span class="line">  DWORD                   dwReadOnlySharedMemoryHeap;</span><br><span class="line">  DWORD                   dwReadOnlyStaticServerData;</span><br><span class="line">  DWORD                   dwAnsiCodePageData;</span><br><span class="line">  DWORD                   dwOemCodePageData;</span><br><span class="line">  DWORD                   dwUnicodeCaseTableData;</span><br><span class="line">  DWORD                   dwNumberOfProcessors;</span><br><span class="line">  DWORD                   dwNtGlobalFlag;</span><br><span class="line">  DWORD                   dwSpare2;</span><br><span class="line">  DWORD                   dwCriticalSectionTimeout1;</span><br><span class="line">  DWORD                   dwCriticalSectionTimeout2;</span><br><span class="line">  DWORD                   dwHeapSegmentReserve;</span><br><span class="line">  DWORD                   dwHeapSegmentCommit;</span><br><span class="line">  DWORD                   dwHeapDeCommitTotalFreeThreshold;</span><br><span class="line">  DWORD                   dwHeapDeCommitFreeBlockThreshold;</span><br><span class="line">  DWORD                   dwNumberOfHeaps;                              </span><br><span class="line">  DWORD                   dwMaximumNumberOfHeaps;                        </span><br><span class="line">  DWORD                   *ProcessHeaps;                               </span><br><span class="line">  DWORD                   dwGdiSharedHandleTable;</span><br><span class="line">  DWORD                   dwProcessStarterHelper;</span><br><span class="line">  DWORD                   dwGdiDCAttributeList;</span><br><span class="line">  DWORD                   dwLoaderLock;</span><br><span class="line">  DWORD                   dwOSMajorVersion;</span><br><span class="line">  DWORD                   dwOSMinorVersion;</span><br><span class="line">  DWORD                   dwOSBuildNumber;</span><br><span class="line">  DWORD                   dwOSPlatformId;</span><br><span class="line">  DWORD                   dwImageSubSystem;</span><br><span class="line">  DWORD                   dwImageSubSystemMajorVersion;</span><br><span class="line">  DWORD                   dwImageSubSystemMinorVersion;</span><br><span class="line">  DWORD                   GdiHandleBuffer[<span class="number">0x22</span>];</span><br><span class="line">  DWORD                   dwPostProcessInitRoutine;</span><br><span class="line">  DWORD                   dwTlsExpansionBitmap;</span><br><span class="line">  BYTE                    TlsExpansionBitmapBits[<span class="number">0x80</span>];</span><br><span class="line">  DWORD                   dwSessionId;</span><br><span class="line">&#125;</span><br><span class="line">PEB;</span><br></pre></td></tr></table></figure>

<p>As you can see there’s a lot that can be tested to evade sandboxing software due to the fact that most of them won’t emulate a correct PEB, the following source code will demonstrate how to read it and print many informations about the process.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PROCESS_BASIC_INFORMATION</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  PVOID Reserved1;</span><br><span class="line">  PVOID PebBaseAddress;</span><br><span class="line">  PVOID Reserved2[<span class="number">2</span>];</span><br><span class="line">  ULONG_PTR UniqueProcessId;</span><br><span class="line">  PVOID Reserved3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">PEB_LDR_DATA</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  BYTE       Reserved1[<span class="number">8</span>];</span><br><span class="line">  PVOID      Reserved2[<span class="number">3</span>];</span><br><span class="line">  LIST_ENTRY InMemoryOrderModuleList;</span><br><span class="line">&#125;</span><br><span class="line">PEB_LDR_DATA ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">TIB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  PEXCEPTION_REGISTRATION_RECORD* ExceptionList; <span class="comment">// FS:0x00</span></span><br><span class="line">  DWORD dwStackBase;                             <span class="comment">// FS:0x04</span></span><br><span class="line">  DWORD dwStackLimit;                            <span class="comment">// FS:0x08</span></span><br><span class="line">  DWORD dwSubSystemTib;                          <span class="comment">// FS:0x0C</span></span><br><span class="line">  DWORD dwFiberData;                             <span class="comment">// FS:0x10</span></span><br><span class="line">  DWORD dwArbitraryUserPointer;                  <span class="comment">// FS:0x14</span></span><br><span class="line">  DWORD dwTIBOffset;                             <span class="comment">// FS:0x18</span></span><br><span class="line">&#125;</span><br><span class="line">TIB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">PEB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  BYTE                    InheritedAddressSpace;</span><br><span class="line">  BYTE                    ReadImageFileExecOptions;</span><br><span class="line">  BYTE                    BeingDebugged;</span><br><span class="line">  BYTE                    Spare;</span><br><span class="line">  DWORD                   dwMutant;                              </span><br><span class="line">  DWORD                   dwImageBaseAddress;                                                      </span><br><span class="line">  PEB_LDR_DATA*           LoaderData;                                                                      </span><br><span class="line">  DWORD                   dwProcessParameters;                                                </span><br><span class="line">  DWORD                   dwSubSystemData;                     </span><br><span class="line">  DWORD                   dwProcessHeap;                       </span><br><span class="line">  DWORD                   dwFastPebLock;                       </span><br><span class="line">  DWORD                   dwFastPebLockRoutine;                </span><br><span class="line">  DWORD                   dwFastPebUnlockRoutine;              </span><br><span class="line">  DWORD                   dwEnvironmentUpdateCount;            </span><br><span class="line">  DWORD                   dwKernelCallbackTable;               </span><br><span class="line">  DWORD                   dwEventLogSection;                   </span><br><span class="line">  DWORD                   dwEventLog;                          </span><br><span class="line">  DWORD                   dwFreeList;                          </span><br><span class="line">  DWORD                   dwTlsExpansionCounter;               </span><br><span class="line">  DWORD                   dwTlsBitmap;                         </span><br><span class="line">  DWORD                   dwTlsBitmapBits[<span class="number">0x2</span>];</span><br><span class="line">  DWORD                   dwReadOnlySharedMemoryBase;</span><br><span class="line">  DWORD                   dwReadOnlySharedMemoryHeap;</span><br><span class="line">  DWORD                   dwReadOnlyStaticServerData;</span><br><span class="line">  DWORD                   dwAnsiCodePageData;</span><br><span class="line">  DWORD                   dwOemCodePageData;</span><br><span class="line">  DWORD                   dwUnicodeCaseTableData;</span><br><span class="line">  DWORD                   dwNumberOfProcessors;</span><br><span class="line">  DWORD                   dwNtGlobalFlag;</span><br><span class="line">  DWORD                   dwSpare2;</span><br><span class="line">  DWORD                   dwCriticalSectionTimeout1;</span><br><span class="line">  DWORD                   dwCriticalSectionTimeout2;</span><br><span class="line">  DWORD                   dwHeapSegmentReserve;</span><br><span class="line">  DWORD                   dwHeapSegmentCommit;</span><br><span class="line">  DWORD                   dwHeapDeCommitTotalFreeThreshold;</span><br><span class="line">  DWORD                   dwHeapDeCommitFreeBlockThreshold;</span><br><span class="line">  DWORD                   dwNumberOfHeaps;                              </span><br><span class="line">  DWORD                   dwMaximumNumberOfHeaps;                        </span><br><span class="line">  DWORD                   *ProcessHeaps;                               </span><br><span class="line">  DWORD                   dwGdiSharedHandleTable;</span><br><span class="line">  DWORD                   dwProcessStarterHelper;</span><br><span class="line">  DWORD                   dwGdiDCAttributeList;</span><br><span class="line">  DWORD                   dwLoaderLock;</span><br><span class="line">  DWORD                   dwOSMajorVersion;</span><br><span class="line">  DWORD                   dwOSMinorVersion;</span><br><span class="line">  DWORD                   dwOSBuildNumber;</span><br><span class="line">  DWORD                   dwOSPlatformId;</span><br><span class="line">  DWORD                   dwImageSubSystem;</span><br><span class="line">  DWORD                   dwImageSubSystemMajorVersion;</span><br><span class="line">  DWORD                   dwImageSubSystemMinorVersion;</span><br><span class="line">  DWORD                   GdiHandleBuffer[<span class="number">0x22</span>];</span><br><span class="line">  DWORD                   dwPostProcessInitRoutine;</span><br><span class="line">  DWORD                   dwTlsExpansionBitmap;</span><br><span class="line">  BYTE                    TlsExpansionBitmapBits[<span class="number">0x80</span>];</span><br><span class="line">  DWORD                   dwSessionId;</span><br><span class="line">&#125;</span><br><span class="line">PEB;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UNICODE_STRING</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  USHORT Length;</span><br><span class="line">  USHORT MaximumLength;</span><br><span class="line">  PWSTR  Buffer;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LDR_MODULE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  LIST_ENTRY              InLoadOrderModuleList;</span><br><span class="line">  LIST_ENTRY              InMemoryOrderModuleList;</span><br><span class="line">  LIST_ENTRY              InInitializationOrderModuleList;</span><br><span class="line">  PVOID                   BaseAddress;</span><br><span class="line">  PVOID                   EntryPoint;</span><br><span class="line">  ULONG                   SizeOfImage;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">UNICODE_STRING</span>  <span class="title">FullDllName</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">UNICODE_STRING</span>  <span class="title">BaseDllName</span>;</span></span><br><span class="line">  ULONG                   Flags;</span><br><span class="line">  SHORT                   LoadCount;</span><br><span class="line">  SHORT                   TlsIndex;</span><br><span class="line">  LIST_ENTRY              HashTableEntry;</span><br><span class="line">  ULONG                   TimeDateStamp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">PROCESSINFOCLASS</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  ProcessBasicInformation = <span class="number">0</span>,</span><br><span class="line">  ProcessDebugPort = <span class="number">7</span>,</span><br><span class="line">  ProcessWow64Information = <span class="number">26</span>,</span><br><span class="line">  ProcessImageFileName = <span class="number">27</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span> <span class="params">(*NtQueryInformationProcess_T)</span><span class="params">( HANDLE, <span class="keyword">enum</span> PROCESSINFOCLASS, PVOID, ULONG, PULONG )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  HMODULE hNtdll;</span><br><span class="line">  NTSTATUS status;</span><br><span class="line">  ULONG bytesReturned;</span><br><span class="line">  PLIST_ENTRY lEntry;</span><br><span class="line">  NtQueryInformationProcess_T pfnNtQueryInformationProcess;</span><br><span class="line">  DWORD dwTIB;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">PROCESS_BASIC_INFORMATION</span> <span class="title">basicInfo</span>;</span></span><br><span class="line">  PEB* peb;</span><br><span class="line">  TIB *tib;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">LDR_MODULE</span> *<span class="title">pLdrModule</span>;</span></span><br><span class="line"></span><br><span class="line">  hNtdll = LoadLibrary(<span class="string">L&quot;ntdll.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">  pfnNtQueryInformationProcess = (NtQueryInformationProcess_T)GetProcAddress(hNtdll, <span class="string">&quot;NtQueryInformationProcess&quot;</span> );</span><br><span class="line"></span><br><span class="line">  assert(pfnNtQueryInformationProcess != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  status = pfnNtQueryInformationProcess( GetCurrentProcess(), ProcessBasicInformation, &amp;basicInfo, <span class="keyword">sizeof</span>(basicInfo), &amp;bytesReturned );</span><br><span class="line"></span><br><span class="line">  assert(status == <span class="number">0</span> &amp;&amp; bytesReturned == <span class="keyword">sizeof</span>(basicInfo));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get our TIB address ( same as mov eax, fs:0x18 )</span></span><br><span class="line">  dwTIB = __readfsdword(<span class="number">0x18</span>);</span><br><span class="line">  tib = (TIB *)dwTIB;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get our PEB address</span></span><br><span class="line">  peb = (PEB *)basicInfo.PebBaseAddress;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.ExceptionList          : %08X\n&quot;</span>, tib-&gt;ExceptionList );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwStackBase            : %08X\n&quot;</span>, tib-&gt;dwStackBase );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwStackLimit           : %08X\n&quot;</span>, tib-&gt;dwStackLimit );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwSubSystemTib         : %08X\n&quot;</span>, tib-&gt;dwSubSystemTib );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwFiberData            : %08X\n&quot;</span>, tib-&gt;dwFiberData );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwArbitraryUserPointer : %08X\n&quot;</span>, tib-&gt;dwArbitraryUserPointer );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;TIB.dwTIBOffset            : %08X\n&quot;</span>, tib-&gt;dwTIBOffset );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.InheritedAddressSpace : %08X\n&quot;</span>, peb-&gt;InheritedAddressSpace );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.ReadImageFileExecOptions : %08X\n&quot;</span>, peb-&gt;ReadImageFileExecOptions );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.BeingDebugged : %08X\n&quot;</span>, peb-&gt;BeingDebugged );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.Spare : %08X\n&quot;</span>, peb-&gt;Spare );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwMutant : %08X\n&quot;</span>, peb-&gt;dwMutant );                              </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwImageBaseAddress : %08X\n&quot;</span>, peb-&gt;dwImageBaseAddress );                                                      </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.LoaderData : %08X\n&quot;</span>, peb-&gt;LoaderData );                                                                      </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwProcessParameters : %08X\n&quot;</span>, peb-&gt;dwProcessParameters );                                                </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwSubSystemData : %08X\n&quot;</span>, peb-&gt;dwSubSystemData );                     </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwProcessHeap : %08X\n&quot;</span>, peb-&gt;dwProcessHeap );                       </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwFastPebLock : %08X\n&quot;</span>, peb-&gt;dwFastPebLock );                       </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwFastPebLockRoutine : %08X\n&quot;</span>, peb-&gt;dwFastPebLockRoutine );                </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwFastPebUnlockRoutine : %08X\n&quot;</span>, peb-&gt;dwFastPebUnlockRoutine );              </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwEnvironmentUpdateCount : %08X\n&quot;</span>, peb-&gt;dwEnvironmentUpdateCount );            </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwKernelCallbackTable : %08X\n&quot;</span>, peb-&gt;dwKernelCallbackTable );               </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwEventLogSection : %08X\n&quot;</span>, peb-&gt;dwEventLogSection );                   </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwEventLog : %08X\n&quot;</span>, peb-&gt;dwEventLog );                          </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwFreeList : %08X\n&quot;</span>, peb-&gt;dwFreeList );                          </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwTlsExpansionCounter : %08X\n&quot;</span>, peb-&gt;dwTlsExpansionCounter );               </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwTlsBitmap : %08X\n&quot;</span>, peb-&gt;dwTlsBitmap );                         </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwReadOnlySharedMemoryBase : %08X\n&quot;</span>, peb-&gt;dwReadOnlySharedMemoryBase );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwReadOnlySharedMemoryHeap : %08X\n&quot;</span>, peb-&gt;dwReadOnlySharedMemoryHeap );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwReadOnlyStaticServerData : %08X\n&quot;</span>, peb-&gt;dwReadOnlyStaticServerData );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwAnsiCodePageData : %08X\n&quot;</span>, peb-&gt;dwAnsiCodePageData );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwOemCodePageData : %08X\n&quot;</span>, peb-&gt;dwOemCodePageData );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwUnicodeCaseTableData : %08X\n&quot;</span>, peb-&gt;dwUnicodeCaseTableData );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwNumberOfProcessors : %08X\n&quot;</span>, peb-&gt;dwNumberOfProcessors );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwNtGlobalFlag : %08X\n&quot;</span>, peb-&gt;dwNtGlobalFlag );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwSpare2 : %08X\n&quot;</span>, peb-&gt;dwSpare2 );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwCriticalSectionTimeout1 : %08X\n&quot;</span>, peb-&gt;dwCriticalSectionTimeout1 );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwCriticalSectionTimeout2 : %08X\n&quot;</span>, peb-&gt;dwCriticalSectionTimeout2 );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwHeapSegmentReserve : %08X\n&quot;</span>, peb-&gt;dwHeapSegmentReserve );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwHeapSegmentCommit : %08X\n&quot;</span>, peb-&gt;dwHeapSegmentCommit );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwHeapDeCommitTotalFreeThreshold : %08X\n&quot;</span>, peb-&gt;dwHeapDeCommitTotalFreeThreshold );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwHeapDeCommitFreeBlockThreshold : %08X\n&quot;</span>, peb-&gt;dwHeapDeCommitFreeBlockThreshold );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwNumberOfHeaps : %08X\n&quot;</span>, peb-&gt;dwNumberOfHeaps );                              </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwMaximumNumberOfHeaps : %08X\n&quot;</span>, peb-&gt;dwMaximumNumberOfHeaps );                        </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.*ProcessHeaps : %08X\n&quot;</span>, peb-&gt;ProcessHeaps );                               </span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwGdiSharedHandleTable : %08X\n&quot;</span>, peb-&gt;dwGdiSharedHandleTable );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwProcessStarterHelper : %08X\n&quot;</span>, peb-&gt;dwProcessStarterHelper );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwGdiDCAttributeList : %08X\n&quot;</span>, peb-&gt;dwGdiDCAttributeList );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwLoaderLock : %08X\n&quot;</span>, peb-&gt;dwLoaderLock );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwOSMajorVersion : %08X\n&quot;</span>, peb-&gt;dwOSMajorVersion );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwOSMinorVersion : %08X\n&quot;</span>, peb-&gt;dwOSMinorVersion );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwOSBuildNumber : %08X\n&quot;</span>, peb-&gt;dwOSBuildNumber );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwOSPlatformId : %08X\n&quot;</span>, peb-&gt;dwOSPlatformId );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwImageSubSystem : %08X\n&quot;</span>, peb-&gt;dwImageSubSystem );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwImageSubSystemMajorVersion : %08X\n&quot;</span>, peb-&gt;dwImageSubSystemMajorVersion );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwImageSubSystemMinorVersion : %08X\n&quot;</span>, peb-&gt;dwImageSubSystemMinorVersion );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwPostProcessInitRoutine : %08X\n&quot;</span>, peb-&gt;dwPostProcessInitRoutine );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwTlsExpansionBitmap : %08X\n&quot;</span>, peb-&gt;dwTlsExpansionBitmap );</span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;PEB.dwSessionId : %08X\n&quot;</span>, peb-&gt;dwSessionId );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the main module</span></span><br><span class="line">  pLdrModule = (struct LDR_MODULE*)peb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span></span><br><span class="line">  (</span><br><span class="line">    <span class="string">&quot;%-17S base@ %10p size: %10x flags: %12x\n&quot;</span>,</span><br><span class="line">    pLdrModule-&gt;FullDllName.Buffer,</span><br><span class="line">    pLdrModule-&gt;BaseAddress,</span><br><span class="line">    pLdrModule-&gt;SizeOfImage,</span><br><span class="line">    pLdrModule-&gt;Flags</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// loop each loaded module</span></span><br><span class="line">  <span class="keyword">for</span>( lEntry = peb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink-&gt;Flink; pLdrModule-&gt;BaseAddress != <span class="number">0</span>; lEntry = lEntry-&gt;Flink )</span><br><span class="line">  &#123;</span><br><span class="line">    pLdrModule = (struct LDR_MODULE*)lEntry;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span></span><br><span class="line">    (</span><br><span class="line">      <span class="string">&quot;%-17S base@ %10p size: %10x flags: %12x\n&quot;</span>,</span><br><span class="line">      pLdrModule-&gt;FullDllName.Buffer,</span><br><span class="line">      pLdrModule-&gt;BaseAddress,</span><br><span class="line">      pLdrModule-&gt;SizeOfImage,</span><br><span class="line">      pLdrModule-&gt;Flags</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FreeLibrary( hNtdll );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </div>

  
    <div class="post-tags">
      
        <a href="/tags/hooking/" class="tag">#hooking</a>
      
        <a href="/tags/api-hooking/" class="tag">#api hooking</a>
      
        <a href="/tags/binary-analysis/" class="tag">#binary analysis</a>
      
        <a href="/tags/emulator/" class="tag">#emulator</a>
      
        <a href="/tags/malware/" class="tag">#malware</a>
      
        <a href="/tags/win32/" class="tag">#win32</a>
      
        <a href="/tags/windows-internals/" class="tag">#windows internals</a>
      
        <a href="/tags/tib/" class="tag">#tib</a>
      
        <a href="/tags/process-environment-block/" class="tag">#process environment block</a>
      
        <a href="/tags/ldr/" class="tag">#ldr</a>
      
        <a href="/tags/loader/" class="tag">#loader</a>
      
        <a href="/tags/pe/" class="tag">#pe</a>
      
        <a href="/tags/vm/" class="tag">#vm</a>
      
        <a href="/tags/evasion/" class="tag">#evasion</a>
      
        <a href="/tags/anti-debugging/" class="tag">#anti-debugging</a>
      
        <a href="/tags/sandbox-detection/" class="tag">#sandbox detection</a>
      
    </div>
  

  <nav class="post-navigation">
    
      <a href="/2014/02/05/Termination-and-injection-self-defense-on-Windows-Vista-SP1/" class="nav-prev">
        <span class="nav-label">PREVIOUS</span>
        <span class="nav-title">Termination and Injection Self Defense on Windows &gt;= Vista SP1</span>
      </a>
    
    
      <a href="/2014/02/01/How-to-hook-Win32-API-with-kernel-patching/" class="nav-next">
        <span class="nav-label">NEXT</span>
        <span class="nav-title">How to Hook Win32 API With Kernel Patching</span>
      </a>
    
  </nav>
</article>


  


<section class="related-posts">
  <h3 class="related-title">YOU MIGHT ALSO LIKE...</h3>
  <div class="cards-grid cards-grid-related">
    
      

<article class="card card-light">
  <a href="/2019/05/22/How-to-create-a-Malware-detection-system-with-Machine-Learning/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://i.imgur.com/cBCBdlH.png')">
        
      </div>
    
    
    
      <div class="card-content">
        <h2 class="card-title">How to Create a Malware Detection System With Machine Learning</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2016/04/18/How-I-defeated-an-obfuscated-and-anti-tamper-APK-with-some-Python-and-a-home-made-Smali-emulator/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2016/04/apktool.png')">
        
          <div class="card-overlay-content">
            <h2 class="card-title">How I Defeated an Obfuscated and Anti-Tamper APK With Some Python and a Home-Made Smali Emulator.</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2015/05/04/Android-Native-API-Hooking-with-Library-Injection-and-ELF-Introspection/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/default-cover.svg')">
        
          <div class="card-overlay-content">
            <h2 class="card-title">Android Native API Hooking With Library Injection and ELF Introspection.</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-light">
  <a href="/2015/05/02/Using-ARM-Inline-Assembly-and-Naked-Functions-to-fool-Disassemblers/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2015/05/hopper.png')">
        
      </div>
    
    
    
      <div class="card-content">
        <h2 class="card-title">Using ARM Inline Assembly and Naked Functions to Fool Disassemblers</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
  </div>
</section>




  </main>
  
  <footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-social">
      
        
          
            <a href="https://github.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
        
          
            <a href="https://twitter.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
          
        
          
            <a href="http://it.linkedin.com/in/simonemargaritelli/" class="social-link" target="_blank" rel="noopener" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          
        
          
        
          
            <a href="mailto:evilsocket@gmail.com" class="social-link" aria-label="Email">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </a>
          
        
      
    </div>
    <p class="footer-copyright">
      &copy; 2025 evilsocket. 
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>.
    </p>
  </div>
</footer>

  <!-- Minimal JS - no external dependencies needed -->
<script>
  // Lazy load images
  document.addEventListener('DOMContentLoaded', function() {
    var images = document.querySelectorAll('.card-image[data-bg]');
    images.forEach(function(img) {
      img.style.backgroundImage = 'url(' + img.dataset.bg + ')';
    });
  });
</script>

</body>
</html>
