<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>How to Use Old GSM Protocols/encodings to Know if a User Is Online on the GSM Network AKA PingSMS 2.0 | evilsocket</title>
<meta name="description" content="In the last few months I’ve been playing with Android’s low level GSM API, a few years ago the (in)famous sendRawPdu API was available, allowing a developer to ">


  <link rel="alternate" href="/atom.xml" title="evilsocket" type="application/atom+xml">


<link rel="icon" href="/images/favicon.ico">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="How to Use Old GSM Protocols/encodings to Know if a User Is Online on the GSM Network AKA PingSMS 2.0">
<meta property="og:description" content="In the last few months I’ve been playing with Android’s low level GSM API, a few years ago the (in)famous sendRawPdu API was available, allowing a developer to ">
<meta property="og:url" content="/2015/07/27/How-to-use-old-GSM-protocols-encodings-to-know-if-a-user-is-Online-on-the-GSM-Network-AKA-PingSMS-2-0/">
<meta property="og:site_name" content="evilsocket">

  
  
    <meta property="og:image" content="/images/default-cover.svg">
  


<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="How to Use Old GSM Protocols/encodings to Know if a User Is Online on the GSM Network AKA PingSMS 2.0">
<meta name="twitter:description" content="In the last few months I’ve been playing with Android’s low level GSM API, a few years ago the (in)famous sendRawPdu API was available, allowing a developer to ">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="/css/style.css">


<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-22026549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-22026549-1');
</script>


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="post-page">
  <header class="site-header">
  <div class="header-inner">
    <div class="site-branding">
      <a href="/" class="site-logo">
        
          <img src="/images/glider.png" alt="evilsocket" width="50" height="50">
        
        <span class="site-title">evilsocket</span>
      </a>
    </div>
    
    <nav class="site-nav">
      
        <a href="/" class="nav-link">
          HOME
        </a>
      
        <a href="/atom.xml" class="nav-link">
          RSS
        </a>
      
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <article class="post-full">
  <header class="post-header">
    <h1 class="post-title">How to Use Old GSM Protocols/encodings to Know if a User Is Online on the GSM Network AKA PingSMS 2.0</h1>
    <div class="post-meta">
      BY <span class="post-author">Simone Margaritelli</span>
      — <time datetime="2015-07-27T19:47:03.000Z">27 Jul 2015</time>
      
        — <a href="/tags/gsm/" class="post-category">gsm</a>, <a href="/tags/sms/" class="post-category">sms</a>, <a href="/tags/mms/" class="post-category">mms</a>, <a href="/tags/wap/" class="post-category">wap</a>, <a href="/tags/wap-push/" class="post-category">wap push</a>, <a href="/tags/wap-push-notifications/" class="post-category">wap push notifications</a>, <a href="/tags/delivery-report/" class="post-category">delivery report</a>, <a href="/tags/pdu/" class="post-category">pdu</a>, <a href="/tags/SmsManager-sendDataMessage/" class="post-category">SmsManager.sendDataMessage</a>, <a href="/tags/SmsManager/" class="post-category">SmsManager</a>, <a href="/tags/sendDataMessage/" class="post-category">sendDataMessage</a>, <a href="/tags/ping-sms/" class="post-category">ping sms</a>
      
    </div>
  </header>

  
  
    <div class="post-cover">
      <img src="/images/default-cover.svg" alt="How to Use Old GSM Protocols/encodings to Know if a User Is Online on the GSM Network AKA PingSMS 2.0">
    </div>
  

  <div class="post-content">
    <p>In the last few months I’ve been playing with Android’s low level GSM API, a few years ago the (in)famous <strong>sendRawPdu</strong> API was available, allowing a developer to manually encode a SMS message at a very low level before sending it to the GSM baseband itself and quite a few applications sending all kind of weird SMS ( flash sms, silent sms, etc ) were born ( for a brief overview of PDU encoding refer to <a target="_blank" rel="noopener" href="http://www.smartposition.nl/resources/sms_pdu.html">this page</a> ).</p>
<p>(Un)fortunately Google decided to remove that API, it’s still not sure if they did it for security related purposes or during some refactoring of their IPC IBinder mechanism, but nowadays it’s no more available unless you use some very old phones/firmwares ( on most devices they removed the ttyUSB serial interfaces to send AT commands to the GSM modem as well ).</p>
<p>Until a couple of months ago, when I found the <strong>SmsManager.sendDataMessage</strong> API which, apparently, it’s not used anywhere ( if you search for it you’ll find only a few examples, but nothing regarding how to use it with manually encoded PDUs ).<br>Using this API we’re able to manually encode our SMS, moreover we can specific a “port” as one of its arguments which will identify what kind of sms we’re gonna send, in this post I’ll talk about port 2948, namely the port used to send <strong>WAP PUSH notifications</strong>.</p>
<span id="more"></span>

<p>WAP PUSH messages were an old mechanism to basically force a remote device to visit a URL encoded in the SMS payload itself ( I know, security wise it was very dumb, but we’re talking about the 90s ), this specific request is called a “<strong>Service Load</strong>” (SL) request, where an XML payload like the following was encoded in a binary form and sent along the PDU to the device.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">sl</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//WAPFORUM//DTD SL 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">                    <span class="meta-string">&quot;www.wapforum.org/DTD/sl.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sl</span> <span class="attr">href</span>=<span class="string">&quot;http://some-evil-site.com/evil-content.html&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Nowadays this protocol is no more handled for obvious reasons … I said <strong>handled</strong> and not <strong>supported</strong> because the GSM basebands software is actually still able to receive it, but the higher level software ( the OS and its components ) will simply ignore it.<br>For instance, on Android 5.0 you can see the following logs ( <code>logcat -b radio</code> ) when the device receives such payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;WAP PUSH( 1287): Rx: 0a0603...</span><br><span class="line">D&#x2F;RILC    (  185): SOCKET RIL_SOCKET_1 REQUEST: SMS_ACKNOWLEDGE length:20</span><br><span class="line">D&#x2F;RILC    (  185): RequestComplete, RIL_SOCKET_1</span><br><span class="line">E&#x2F;RILC    (  185): Send Response to RIL_SOCKET_1</span><br><span class="line">D&#x2F;RILJ    ( 1287): [9277]&lt; SMS_ACKNOWLEDGE  [SUB0]</span><br><span class="line">V&#x2F;WAP PUSH( 1287): appid found: 2:application&#x2F;vnd.wap.slc</span><br><span class="line">W&#x2F;WAP PUSH( 1287): wap push manager not found!</span><br><span class="line">V&#x2F;WAP PUSH( 1287): fall back to existing handler</span><br><span class="line">V&#x2F;WAP PUSH( 1287): Delivering MMS to: com.google.android.talk com.google.android.apps.hangouts.sms.MmsWapPushDeliverReceiver</span><br></pre></td></tr></table></figure>

<p>So the event is delivered to the Google Hangouts application ( the default SMS/MMS handler on my phone ) which simply <strong>will ignore this kind of payloads</strong> unless they are simple MMS instead of anything else ( WAP PUSHes in our case ):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MmsWapPushDeliverReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context paramContext, Intent paramIntent)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="string">&quot;android.provider.Telephony.WAP_PUSH_DELIVER&quot;</span>.equals(paramIntent.getAction())) &amp;&amp; (<span class="string">&quot;application/vnd.wap.mms-message&quot;</span>.equals(paramIntent.getType())))</span><br><span class="line">      RealTimeChatService.a(paramIntent.getByteArrayExtra(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This means that, although the device will receive the data, <strong>no kind of notification will be shown to the user</strong> and the data itself won’t be saved anywhere in the system, but simply discarded.</p>
<p>Having said that, there’s a tiny detail that’s very handy for us … after delivering the WAP PUSH message, the destination <strong>operator BTS will reply to us with a delivery report</strong>. This report will be sent only if the device is turned on and completely able to receive the message ( turned on and with enough GSM network coverage ).<br>In fact, the sendDataMessage API accepts as its last argument a delivery PendingIntent, in other words our application will be informed as soon as the delivery report will be sent back.</p>
<p>We can take advantage of this to do the following:</p>
<ul>
<li>Craft a WAP PUSH message encoding it manually.</li>
<li>Pass it to the sendDataMessage API and register a delivery intent.</li>
<li>The WAP PUSH will be sent to the target mobile phone and we’ll receive the delivery notification if the phone is turned on, if it’s not we’ll receive it as soon as it will be turned on.</li>
<li>The target user won’t notice absolutely anything.</li>
</ul>
<p>So, we can basically track a target user GSM network activity invisibly, knowing exactly when the target’s device is turned on without him having a single chance to notice anything.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/evilsocket/pdusms">Here</a>‘s a very simple PoC application I’ve made to show how to use such API, the same kind of PDU can be sent using a normal GSM serial dongle and some software like Gnokii.</p>

  </div>

  
    <div class="post-tags">
      
        <a href="/tags/gsm/" class="tag">#gsm</a>
      
        <a href="/tags/sms/" class="tag">#sms</a>
      
        <a href="/tags/mms/" class="tag">#mms</a>
      
        <a href="/tags/wap/" class="tag">#wap</a>
      
        <a href="/tags/wap-push/" class="tag">#wap push</a>
      
        <a href="/tags/wap-push-notifications/" class="tag">#wap push notifications</a>
      
        <a href="/tags/delivery-report/" class="tag">#delivery report</a>
      
        <a href="/tags/pdu/" class="tag">#pdu</a>
      
        <a href="/tags/SmsManager-sendDataMessage/" class="tag">#SmsManager.sendDataMessage</a>
      
        <a href="/tags/SmsManager/" class="tag">#SmsManager</a>
      
        <a href="/tags/sendDataMessage/" class="tag">#sendDataMessage</a>
      
        <a href="/tags/ping-sms/" class="tag">#ping sms</a>
      
    </div>
  

  <nav class="post-navigation">
    
      <a href="/2015/10/26/Karma-Come-l-Open-Source-ha-cambiato-la-mia-vita/" class="nav-prev">
        <span class="nav-label">PREVIOUS</span>
        <span class="nav-title">Karma: Come l&#39;Open Source Ha Cambiato La Mia Vita.</span>
      </a>
    
    
      <a href="/2015/07/25/Bettercap-A-complete-modular-portable-and-easily-extensible-MITM-framework/" class="nav-next">
        <span class="nav-label">NEXT</span>
        <span class="nav-title">Bettercap - a Complete, Modular, Portable and Easily Extensible MITM Framework.</span>
      </a>
    
  </nav>
</article>


  


<section class="related-posts">
  <h3 class="related-title">YOU MIGHT ALSO LIKE...</h3>
  <div class="cards-grid cards-grid-related">
    
      

<article class="card card-light">
  <a href="/2016/08/24/RCE-against-every-open-source-BTS/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://blog.zimperium.com/wp-content/uploads/2016/08/chart-1.png')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">vulnerability</span>
        
        <h2 class="card-title">DISCLOSURE - RCE Against Every Open Source BTS Software.</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2016/03/31/How-To-Build-Your-Own-Rogue-GSM-BTS-For-Fun-And-Profit/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2016/03/bts.jpeg')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">hacking</span>
            
            <h2 class="card-title">How to Build Your Own Rogue GSM BTS for Fun and Profit</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2015/02/01/Huawei-Modems-Authentication-Bypass/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2015/02/Huawei-Logo1422524173.jpg')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">hack</span>
            
            <h2 class="card-title">Huawei Modems Authentication Bypass</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-light">
  <a href="/2025/03/13/How-To-Write-An-Agent/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2025/agent/loop.png')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">agent</span>
        
        <h2 class="card-title">How to Write an Agent</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
  </div>
</section>




  </main>
  
  <footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-social">
      
        
          
            <a href="https://github.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
        
          
            <a href="https://twitter.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
          
        
          
            <a href="http://it.linkedin.com/in/simonemargaritelli/" class="social-link" target="_blank" rel="noopener" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          
        
          
        
          
            <a href="mailto:evilsocket@gmail.com" class="social-link" aria-label="Email">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </a>
          
        
      
    </div>
    <p class="footer-copyright">
      &copy; 2025 evilsocket. 
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>.
    </p>
  </div>
</footer>

  <!-- Minimal JS - no external dependencies needed -->
<script>
  // Lazy load images
  document.addEventListener('DOMContentLoaded', function() {
    var images = document.querySelectorAll('.card-image[data-bg]');
    images.forEach(function(img) {
      img.style.backgroundImage = 'url(' + img.dataset.bg + ')';
    });
  });
</script>

</body>
</html>
