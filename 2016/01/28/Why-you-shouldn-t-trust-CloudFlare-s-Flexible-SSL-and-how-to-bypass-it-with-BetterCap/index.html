<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap | evilsocket</title>
<meta name="description" content="Let me clear one thing about this post … this is not a CloudFlare vulnerability report and, even in that case, there’s really nothing they could do in order to ">


  <link rel="alternate" href="/atom.xml" title="evilsocket" type="application/atom+xml">


<link rel="icon" href="/images/favicon.ico">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap">
<meta property="og:description" content="Let me clear one thing about this post … this is not a CloudFlare vulnerability report and, even in that case, there’s really nothing they could do in order to ">
<meta property="og:url" content="/2016/01/28/Why-you-shouldn-t-trust-CloudFlare-s-Flexible-SSL-and-how-to-bypass-it-with-BetterCap/">
<meta property="og:site_name" content="evilsocket">

  
  
    <meta property="og:image" content="/images/2016/01/Schermata-2016-01-28-alle-18-08-27.png">
  


<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap">
<meta name="twitter:description" content="Let me clear one thing about this post … this is not a CloudFlare vulnerability report and, even in that case, there’s really nothing they could do in order to ">

<!-- Schema.org JSON-LD -->


<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.evilsocket.net/2016/01/28/Why-you-shouldn-t-trust-CloudFlare-s-Flexible-SSL-and-how-to-bypass-it-with-BetterCap/"},"headline":"Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap","description":"Let me clear one thing about this post … this is not a CloudFlare vulnerability report and, even in that case, there’s really nothing they could do in order to ","image":"https://www.evilsocket.net/images/2016/01/Schermata-2016-01-28-alle-18-08-27.png","datePublished":"2016-01-28T19:32:13.000Z","dateModified":"2025-12-19T18:35:53.166Z","author":{"@type":"Person","name":"Simone Margaritelli","description":"Italian cybersecurity researcher, hacker, and open-source developer with over two decades of experience in network security, AI, and offensive security tools.","url":"https://www.evilsocket.net","image":"https://www.evilsocket.net/images/glider.png","sameAs":["https://github.com/evilsocket","https://twitter.com/evilsocket","http://it.linkedin.com/in/simonemargaritelli/","https://www.goodreads.com/evilsocket","https://www.patreon.com/evilsocket","https://keybase.io/evilsocket"],"jobTitle":"Security Researcher","knowsAbout":["Cybersecurity","Penetration Testing","Network Security","Reverse Engineering","Open Source Development","Wireless Security","Machine Learning","Go Programming","Python","C/C++"],"award":["Creator of bettercap","Creator of pwnagotchi","Creator of OpenSnitch","CVE-2024-47176 discoverer"],"worksFor":{"@type":"Organization","name":"Independent"}},"publisher":{"@type":"Organization","name":"evilsocket","url":"https://www.evilsocket.net","logo":{"@type":"ImageObject","url":"https://www.evilsocket.net/images/glider.png"}},"keywords":"bettercap, mitm, network attacks, traffic interception, https, http, security, ssl, ssl stripping, sslstrip, sslstripping, cloudflare, flexible ssl, hsts, cdn security, downgrade attack","articleSection":"Cybersecurity","inLanguage":"en"}
</script>


<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="/css/style.css">


<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-22026549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-22026549-1');
</script>


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="post-page">
  <header class="site-header">
  <div class="header-inner">
    <div class="site-branding">
      <a href="/" class="site-logo">
        
          <img src="/images/glider.png" alt="evilsocket" width="50" height="50">
        
        <div class="site-title-group">
          <span class="site-title">evilsocket</span>
          <span class="site-motto">Preoccupied with a single leaf, you won't see the tree. Preoccupied with a single tree... you'll miss the entire forest.</span>
        </div>
      </a>
    </div>
    
    <nav class="site-nav">
      
        <a href="/" class="nav-link">
          HOME
        </a>
      
        <a href="/atom.xml" class="nav-link">
          RSS
        </a>
      
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <article class="post-full">
  <header class="post-header">
    <h1 class="post-title">Why You Shouldn&#39;t Trust CloudFlare&#39;s &#39;Flexible SSL&#39; and How to Bypass It With BetterCap</h1>
    <div class="post-meta">
      BY <span class="post-author">Simone Margaritelli</span>
      — <time datetime="2016-01-28T19:32:13.000Z">28 Jan 2016</time>
      
        — <a href="/tags/bettercap/" class="post-category">bettercap</a>, <a href="/tags/mitm/" class="post-category">mitm</a>, <a href="/tags/network-attacks/" class="post-category">network attacks</a>, <a href="/tags/traffic-interception/" class="post-category">traffic interception</a>, <a href="/tags/https/" class="post-category">https</a>, <a href="/tags/http/" class="post-category">http</a>, <a href="/tags/security/" class="post-category">security</a>, <a href="/tags/ssl/" class="post-category">ssl</a>, <a href="/tags/ssl-stripping/" class="post-category">ssl stripping</a>, <a href="/tags/sslstrip/" class="post-category">sslstrip</a>, <a href="/tags/sslstripping/" class="post-category">sslstripping</a>, <a href="/tags/cloudflare/" class="post-category">cloudflare</a>, <a href="/tags/flexible-ssl/" class="post-category">flexible ssl</a>, <a href="/tags/hsts/" class="post-category">hsts</a>, <a href="/tags/cdn-security/" class="post-category">cdn security</a>, <a href="/tags/downgrade-attack/" class="post-category">downgrade attack</a>
      
    </div>
    <br/>
    <a target="_blank" rel="noopener" href="https://twitter.com/evilsocket" class="twitter-follow-button" data-show-count="false">Follow me on X</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </header>

  <div class="post-content">
    <p>Let me clear one thing about this post … this is <strong>not</strong> a CloudFlare vulnerability report and, even in that case, there’s really nothing they could do in order to fix it     <del>unless they’d block direct traffic to HTTP websites</del>.<br>This is only a blog post about why you shouldn’t blindly trust free services that offer you some sort of SSL protection if your server itself is not SSL protected by default.</p>
<span id="more"></span>

<p><strong>UPDATE</strong>: <em>n0on3</em> <a target="_blank" rel="noopener" href="https://twitter.com/n0on3/status/692763330210091009">noted on twitter</a> that <em>even a properly configured server / blocking plain HTTP won’t work if the mitm catches the first request</em>.</p>
<p>During this week, I’ve been playing with CloudFlare free plan in order to turn my websites into HTTPS protected websites, while configuring my account and playing a little bit with <a target="_blank" rel="noopener" href="https://www.bettercap.org/">bettercap</a> I figured out something really weird and I tweeted <a target="_blank" rel="noopener" href="https://twitter.com/bettercap/status/691991056469118976">this</a> ( from the @bettercap account ):</p>
<p><img src="/images/2016/01/Schermata-2016-01-28-alle-18-08-27.png" alt="my tweet"></p>
<p>Someone from their team asked me to report this issue on HackerONE and eventually they decided to not accept it … well, not a big deal, I didn’t want to get money out of it in the first place and I didn’t consider this to be a “real” vulnerability from their side, but just something they should take into account while writing their documentation and informing users, this is how it ended ( and that’s why I’m disclosing this ) :</p>
<p><img src="/images/2016/01/pasha.png" alt="HackerOne response"></p>
<h2 class="heading-anchor" id="The-Attack"><a href="#The-Attack" class="anchor-link" aria-hidden="true">#</a><a href="#The-Attack" class="headerlink" title="The Attack"></a>The Attack</h2><p>My configuration is the following:</p>
<ul>
<li>One website hosted on my dedicated server running <strong>only</strong> via HTTP ( no HTTPS available ).</li>
<li>CloudFlare SSL configured to <strong>Flexible</strong> ( since I have no certificate whatsoever ).</li>
</ul>
<p><img src="/images/2016/01/flexiblessl.png" alt="Flexible SSL"></p>
<center><small>As you can see, with Flexible SSL, your server doesn't handle HTTPS traffic by itself.</small></center>

<ul>
<li><strong>HSTS</strong> on with everything enabled ( <strong>browser preload</strong> as well ).</li>
</ul>
<p><img src="/images/2016/01/hsts.png" alt="HSTS"></p>
<ul>
<li>A page rule configured ( as they wrote on the documentation ) to “<strong>Always uses https</strong>“.</li>
</ul>
<p><img src="/images/2016/01/pagerule.png" alt="Page Rule"></p>
<p>What I was expecting was that every request made against the HTTP website would be redirected to the CloudFlare HTTPS endpoint, effectively forcing every user to only browse through HTTPS … well, it turned out that <strong>this configuration is quite easy to bypass</strong> using BetterCap or any other offensive tool that performs <strong>sslstripping</strong> and “Redirect to HTTPS” patching …</p>
<p>But how? And why?</p>
<p>This attack will work <strong>if and only if</strong> the victim/target is browsing the HTTP(S) CloudFlare protected website for the very first time, since from the second time on, its browser would cache the HSTS preload rule and would perform a HTTP -&gt; HTTPS redirect without waiting for an actual 307 redirect from the CloudFlare’s proxy.</p>
<p>You just need to launch bettercap with the following command line arguments:</p>
<pre><code>sudo bettercap -T IP-OF-THE-TARGET --proxy</code></pre>
<p>From that moment on, bettercap will start sslstripping and patching every redirect to HTTPS:</p>
<p><img src="/images/2016/01/bettercap_cloudflare.png" alt="bettercap and cloudflare"></p>
<p>As you can see from the screenshot, once bettercap intercepted the redirect to the HTTPS website, it just killed it and left the victim browsing the page through HTTP ( while proxying the data through HTTPS to the real endpoint ).<br>This allows the tool to see the traffic from both sides in cleartext, manipulate it, and so forth.</p>
<p>This happens because the my original webserver had only the HTTP port exposed and no HTTPS capabilities at all, <del>as I already mentioned the only way for CloudFlare to fix this would be to block all the traffic going through the original HTTP server and only permit it if it’s through SSL.</del></p>

  </div>

  
    <div class="post-tags">
      
        <a href="/tags/bettercap/" class="tag">#bettercap</a>
      
        <a href="/tags/mitm/" class="tag">#mitm</a>
      
        <a href="/tags/network-attacks/" class="tag">#network attacks</a>
      
        <a href="/tags/traffic-interception/" class="tag">#traffic interception</a>
      
        <a href="/tags/https/" class="tag">#https</a>
      
        <a href="/tags/http/" class="tag">#http</a>
      
        <a href="/tags/security/" class="tag">#security</a>
      
        <a href="/tags/ssl/" class="tag">#ssl</a>
      
        <a href="/tags/ssl-stripping/" class="tag">#ssl stripping</a>
      
        <a href="/tags/sslstrip/" class="tag">#sslstrip</a>
      
        <a href="/tags/sslstripping/" class="tag">#sslstripping</a>
      
        <a href="/tags/cloudflare/" class="tag">#cloudflare</a>
      
        <a href="/tags/flexible-ssl/" class="tag">#flexible ssl</a>
      
        <a href="/tags/hsts/" class="tag">#hsts</a>
      
        <a href="/tags/cdn-security/" class="tag">#cdn security</a>
      
        <a href="/tags/downgrade-attack/" class="tag">#downgrade attack</a>
      
    </div>
  

  <nav class="post-navigation">
    
      <a href="/2016/01/30/OSX-Mass-Pwning-using-BetterCap-and-the-Sparkle-Updater-Vulnerability/" class="nav-prev">
        <span class="nav-label">PREVIOUS</span>
        <span class="nav-title">OSX Mass Pwning Using BetterCap and the Sparkle Updater Vulnerability.</span>
      </a>
    
    
      <a href="/2016/01/18/Autopwn-every-Android-4-2-device-on-your-network-using-BetterCap-and-the-addJavascriptInterface-vulnerability/" class="nav-next">
        <span class="nav-label">NEXT</span>
        <span class="nav-title">Autopwn Every Android &lt; 4.2 Device on Your Network Using BetterCap and the addJavascriptInterface Vulnerability.</span>
      </a>
    
  </nav>
</article>


  


<section class="related-posts">
  <h2 class="related-title">YOU MIGHT ALSO LIKE...</h2>
  <div class="cards-grid cards-grid-related">
    
      

<article class="card card-light">
  <a href="/2025/12/18/TP-Link-Tapo-C200-Hardcoded-Keys-Buffer-Overflows-and-Privacy-in-the-Era-of-AI-Assisted-Reverse-Engineering/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2025/tapo/header.jpg')">
        
      </div>
    
    
    
      <div class="card-content">
        <h2 class="card-title">TP-Link Tapo C200: Hardcoded Keys, Buffer Overflows and Privacy in the Era of AI Assisted Reverse Engineering</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2024/09/13/Introducing-bettercap-2-4-0-CAN-bus-hacking-WiFi-bruteforcing-and-builtin-web-UI/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2024/ecus.png')">
        
          <div class="card-overlay-content">
            <h2 class="card-title">Introducing Bettercap 2.4.0: CAN-Bus Hacking, WiFi Bruteforcing and Builtin Web UI</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2023/11/02/Enumerate-Bruteforce-Attack-All-The-Things-Presenting-Legba/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/VeveLegba.svg/800px-VeveLegba.svg.png')">
        
          <div class="card-overlay-content">
            <h2 class="card-title">Enumerate/Bruteforce/Attack All the Things! Presenting Legba</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-light">
  <a href="/2019/10/19/Weaponizing-and-Gamifying-AI-for-WiFi-Hacking-Presenting-Pwnagotchi-1-0-0/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://i.imgur.com/X68GXrn.png')">
        
      </div>
    
    
    
      <div class="card-content">
        <h2 class="card-title">Weaponizing and Gamifying AI for WiFi Hacking: Presenting Pwnagotchi 1.0.0</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
  </div>
</section>




  </main>
  
  <footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-social">
      
        
          
            <a href="https://github.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
        
          
            <a href="https://twitter.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
          
        
          
            <a href="http://it.linkedin.com/in/simonemargaritelli/" class="social-link" target="_blank" rel="noopener" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          
        
          
        
          
            <a href="mailto:evilsocket@gmail.com" class="social-link" aria-label="Email">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </a>
          
        
      
    </div>
    <p class="footer-copyright">
      &copy; 2026 evilsocket. 
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>.
    </p>
  </div>
</footer>

  <script src="/a.js"></script>
<script type="text/javascript">
  A['\u0069\u006E\u0069\u0074']({ '\u0061\u0063\u0074\u0069\u006F\u006E': 'none', "statsEndpoint": "\u0068\u0074\u0074\u0070\u0073\u003A\u002F\u002F\u006E\u006F\u0062\u006F\u0074\u002D\u0073\u0074\u0061\u0074\u0073\u002E\u0065\u0076\u0069\u006C\u0073\u006F\u0063\u006B\u0065\u0074\u002E\u0077\u006F\u0072\u006B\u0065\u0072\u0073\u002E\u0064\u0065\u0076\u002F\u006C\u006F\u0067" });
</script>

<!-- Minimal JS - no external dependencies needed -->
<script>
  // Lazy load images
  document.addEventListener('DOMContentLoaded', function () {
    var images = document.querySelectorAll('.card-image[data-bg]');
    images.forEach(function (img) {
      img.style.backgroundImage = 'url(' + img.dataset.bg + ')';
    });
  });
</script>
</body>
</html>
