<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Hide Your Servers in Plain Sight, Presenting ShieldWall | evilsocket</title>
<meta name="description" content="">


  <link rel="alternate" href="/atom.xml" title="evilsocket" type="application/atom+xml">


<link rel="icon" href="/images/favicon.ico">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="Hide Your Servers in Plain Sight, Presenting ShieldWall">
<meta property="og:description" content="">
<meta property="og:url" content="/2021/02/13/Hide-your-servers-in-plain-sight-presenting-ShieldWall/">
<meta property="og:site_name" content="evilsocket">

  
  
    <meta property="og:image" content="/images/2021/shieldwall_gophers_vikings.jpg">
  


<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Hide Your Servers in Plain Sight, Presenting ShieldWall">
<meta name="twitter:description" content="">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="/css/style.css">


<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-22026549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-22026549-1');
</script>


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="post-page">
  <header class="site-header">
  <div class="header-inner">
    <div class="site-branding">
      <a href="/" class="site-logo">
        
          <img src="/images/glider.png" alt="evilsocket" width="50" height="50">
        
        <span class="site-title">evilsocket</span>
      </a>
    </div>
    
    <nav class="site-nav">
      
        <a href="/" class="nav-link">
          HOME
        </a>
      
        <a href="/atom.xml" class="nav-link">
          RSS
        </a>
      
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <article class="post-full">
  <header class="post-header">
    <h1 class="post-title">Hide Your Servers in Plain Sight, Presenting ShieldWall</h1>
    <div class="post-meta">
      BY <span class="post-author">Simone Margaritelli</span>
      — <time datetime="2021-02-13T14:34:28.000Z">13 Feb 2021</time>
      
        — <a href="/tags/golang/" class="post-category">golang</a>, <a href="/tags/firewall/" class="post-category">firewall</a>, <a href="/tags/server/" class="post-category">server</a>, <a href="/tags/servers/" class="post-category">servers</a>, <a href="/tags/secret/" class="post-category">secret</a>, <a href="/tags/iptables/" class="post-category">iptables</a>, <a href="/tags/shieldwall/" class="post-category">shieldwall</a>, <a href="/tags/remote-firewall-instrumentation/" class="post-category">remote firewall instrumentation</a>
      
    </div>
  </header>

  
  
    <div class="post-cover">
      <img src="/images/2021/shieldwall_gophers_vikings.jpg" alt="Hide Your Servers in Plain Sight, Presenting ShieldWall">
    </div>
  

  <div class="post-content">
    <p><a href="/2020/05/26/Just-taking-a-break/">Long time no see</a> friends! Despite this break period ended up not being as long as I hoped for / needed, it’s been nevertheless refreshing both from a personal standpoint (i can read and write music now!!!!! that’s so freaking awesomeeeeee … anyways) and from a creative one. I’ve been back to coding and publishing a <a target="_blank" rel="noopener" href="https://github.com/evilsocket/uroboros">couple</a> <a target="_blank" rel="noopener" href="https://github.com/evilsocket/ditto">of new tools</a>, but it’s of the third and simplest of them all I want to blog about today :D</p>
<p><em>(sound of viking horns) introducing … project <a target="_blank" rel="noopener" href="https://shieldwall.me/">ShieldWall</a>!</em></p>
<center>
<img src="/images/2021/shieldwall_gophers_vikings.jpg"/>
<small>Credits: <a href="https://www.pinterest.it/pin/584905070337190852/" target="_blank">i have no idea how this works</a></small>
</center>

<p>Say that you need to host some personal / sensitive service of yours, in such a way that it is always easily accessible by any of your devices (including mobile) without configuration (no VPN, SSH tunnel, etc), and <strong>to those devices only</strong> (at the packet level, so that shodan &amp;&amp; friends can’t index the port(s)) as they change their IP addresses? (The last part is clearly what adds complexity to the task.) </p>
<p>While you think about how you would do it (or maybe how you do it already), let me provide some more context with my usecase.</p>
<h3 id="Where-do-I-host-“That-Thing”"><a href="#Where-do-I-host-“That-Thing”" class="headerlink" title="Where do I host “That Thing”?"></a>Where do I host “That Thing”?</h3><p>You might be familiar with my other project, <a target="_blank" rel="noopener" href="https://github.com/evilsocket/arc">Arc</a>, if not go check it out now because it’s pretty useful and it replaces all you password managers, evernotes and todos. Me and the early adopters started using Arc to store all sorts of things. We have instances with passwords, other for 2FA, for documents, notes, reminders, video, audio, and the list keeps going. Since its first version it has improved a lot and now both the API and the frontend live in one single binary compiled for any OS (Golang FTW), but it always had and still has one major usability issue: <em>where do I host that thing</em>? </p>
<p>I mean, as long as you run it and use it just on your laptop, it’s done. And while you’re at home you only need a raspberry pi (or to open the port on your laptop) for other devices like your smartphone to use it. But what how do you do when you’re away from home? Sure the data is end-to-end encrypted so even if you host it on a public server and somebody somehow hacks into it, they just get AES256 enrypted crap. But what if they inject some javascript in the UI that grabs your access and encryption keys next time you use it? Yeah … i am <em>that</em> paranoid … bear with me.</p>
<center>
<img src="/images/2021/paranoia.jpg"/>
</center>

<p>This can be generalized to other usecases. For instance, red team operators might want to keep hidden their infrastructure while still being able to connect for setup and mainteinance. Or really any type of service that needs to be on the public internet for ease of access but that contains data that’s for your eyes only.</p>
<h3 id="Possible-Solutions"><a href="#Possible-Solutions" class="headerlink" title="Possible Solutions"></a>Possible Solutions</h3><p><a href="/2017/12/07/DIY-Portable-Secrets-Manager-with-a-RPI-Zero-and-the-ARC-Project/">My first terrible attempt</a> to make that stuff usable wherever I go was based on Bluetooth (of course this approach doesn’t apply to anything other than my Arc usecase). The idea was to host Arc on a small Raspberry Pi 0 with a battery pack and have the service responding via BTNAP assigned IP address. Not only it was as complex to configure as it sounds, but it was also unstable as f. </p>
<p><del>Bluetooth based solution</del></p>
<p>The second approach was slightly better in terms of usability. Arc was running on a Raspberry Pi at home and published as a Tor hidden service that I started only when leaving home and then accessed with Tor browser using the .onion url I saved each time on some cloud note. That is sloooooooooooow, unreliable as it depends on your home internet connectivity and it still exposes the service to whoever is crawling and indexing hidden services. Not to mention that Tor traffic is blocked in many networks.</p>
<p><del>Tor based solution</del></p>
<p>As <a target="_blank" rel="noopener" href="https://twitter.com/acor3/status/1360501389491916800">Marco Acorte suggested</a> SSH tunneling is a partial solution. You can make the service bind to localhost on the server, then authenticate to it via SSH from the device you need to use, starting an authenticated and encrypted tunnel to the server bound to localhost. It works, but it exposes the ssh port of the server (with its fingerprint, <a target="_blank" rel="noopener" href="https://www.reddit.com/r/onions/comments/2t3bm6/shodan_search_can_use_ssh_fingerprinting_to/">that can be used in many ways</a>) and it’s not the simplest solution when you are on a rush and need to authenticate to something from your mobile device.</p>
<p><del>SSH tunnel based solution</del></p>
<p>VPN is another option but additionally to having the same limitations of the SSH tunnel approach, it also adds setup&amp;configuration complexity. As <a target="_blank" rel="noopener" href="https://twitter.com/NGiollaEaspaig/status/1360599683916324865">@NGiollaEaspaig suggested</a> there are several cloud specific options for this. But not everybody wants to or knows how to setup Azure Conditional Access Policies :D There’s the <a target="_blank" rel="noopener" href="https://twitter.com/acor3/status/1359540384750309376">ngrok based solution</a> too, but it works proxying the traffic to your app, meaning it’s their servers that will receive it and route it to the real server, similarly to what also CloudFlare offers. Both cases you’d be handing over control of your most sensitive traffic to another entity. You see where I am going with this … I’m quite difficult to satisty! :’D</p>
<p><del>CLOUD &amp; Other Paid Friends</del></p>
<iframe width="100%" height="315" src="https://www.youtube.com/embed/CakqPuwFAIc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="Do-you-even-iptables-Bro"><a href="#Do-you-even-iptables-Bro" class="headerlink" title="Do you even iptables Bro?"></a>Do you even iptables Bro?</h3><p>I do believe that the simpler solution is always the best one, and I like the idea of controlling this access mechanism myself via iptables. <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/11851/iptables-allow-certain-ips-and-block-all-other-connection">It is trivial</a> to block all traffic and only allow certain IP addresses on certain ports. Another reason why IMO it’s the best tool for this job is that it works at the packet level, meaning it is protocol agnostic and it doesn’t only work for HTTP based applications. The only (usability) issue in this case is that freaking IP address that changes. You can’t whitelist beforehand something you don’t know yet.</p>
<center>
<img src="/images/2021/smart.png"/>
</center>

<p>So I thought, woudln’t it be so nice and clean having a stupid-simple agent running on this server (normal server on the <em>dangerous public internet</em>), using iptables to <strong>block everything by default</strong> and periodically polling a public API (<a target="_blank" rel="noopener" href="https://shieldwall.me/">hosted elsewhere</a>) that’ll return the list of IP addresses to whitelist. I could then just log in to this public service with my device with a normal browser and just push a rule with my IP. <em>I KNOW RIGHT?!</em></p>
<p>So yeah I coded this thing.</p>
<center>
<img src="/images/2021/shieldwall1.png" width="800px"/>
<br>
<img src="/images/2021/shieldwall2.png" width="800px"/>
</center>

<p>The service is free and <a target="_blank" rel="noopener" href="https://shieldwall.me/#/register">you’re welcome to sign up</a>, use it and <a target="_blank" rel="noopener" href="https://github.com/evilsocket/shieldwall">report any bugs</a> :D Alternatively you can host the API and frontend yourself and have your own infrastructure.</p>
<p>The installation process once you registered an account is pretty simple (Golang FTW again):</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/sw</span><br><span class="line"><span class="built_in">cd</span> /tmp/sw</span><br><span class="line">wget https://github.com/evilsocket/shieldwall/releases/download/v1.0.0/shieldwall-agent_1.0.0_linux_arm64.tar.gz</span><br><span class="line">tar xvf shieldwall-agent_1.0.0_linux_arm64.tar.gz</span><br><span class="line">sudo ./install.sh</span><br></pre></td></tr></table></figure>

<p>The agent is now installed as a systemd service, but it is not yet started nor enabled for autostart. You will first need to register an account on <a target="_blank" rel="noopener" href="https://shieldwall.me/">https://shieldwall.me/</a> and then edit the /etc/shieldwall/config.yaml configuration file, making sure it matches what you see on the agent page.</p>
<p><strong>It is very important that you double check the configuration before the next step, if the agent can’t authenticate because of a wrong token, you will be locked out by the firewall and unable to log back.</strong></p>
<p>You can now enable the service and start it. If configured so, it will automatically download and install its updates from github:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> shieldwall-agent</span><br><span class="line">sudo service shieldwall-agent start</span><br></pre></td></tr></table></figure>

<p>That’s it … now you can use your shieldwall.me account to instrument this agent and only open ports to your IP from a given amount of time (or permantently, but i stronlgy suggest you always set an expire time for the rules so that the agent will block everything again after a while … just in case).</p>
<h3 id="Final-considerations-and-new-features"><a href="#Final-considerations-and-new-features" class="headerlink" title="Final considerations and new features"></a>Final considerations and new features</h3><p>ShieldWall is a very simple concept that can nevertheless offer a strong layer of security. But that’s what it is, just one layer. It is not intended to replace a proper authentication mechanism in your service, or strong passwords or generally speaking good practices in security. But damn if it works well in what it does :D</p>
<p>Right now it only supports iptables and even tho it’s relatively trivial to implement the support for other firewalls I’m not planning to do it unless I’ll see some major interest in the project. Other ideas include the use of an intermediary S3 bucket, let me explain this.</p>
<p>Your agents will be talking to the shieldwall.me server, meaning that I (or whoever is controlling the infrastructure if you hosted it elsewhere) can potentially know the IP addresses of your servers. I really don’t care to be honest, but in order to add an additional level of privacy what I could do is giving you the option to specify the connection details to an S3 bucket in your control in your shieldwall.me profile page. If configured so, the server would be only pushing the JSON of the rules to that bucket for your agents to consume. That way my server and the agents would never see each other and there wouldn’t be any way for the server administrator to even know their IP addresses.</p>
<p>In this case as well, not planning on implementing it any time soon unless I see registrations going up, as the tool already works great as it is for my usecase :D</p>
<p>I hope you enjoyed the post and most importantly that you’ll find the service useful, cheers! ^_^</p>

  </div>

  
    <div class="post-tags">
      
        <a href="/tags/golang/" class="tag">#golang</a>
      
        <a href="/tags/firewall/" class="tag">#firewall</a>
      
        <a href="/tags/server/" class="tag">#server</a>
      
        <a href="/tags/servers/" class="tag">#servers</a>
      
        <a href="/tags/secret/" class="tag">#secret</a>
      
        <a href="/tags/iptables/" class="tag">#iptables</a>
      
        <a href="/tags/shieldwall/" class="tag">#shieldwall</a>
      
        <a href="/tags/remote-firewall-instrumentation/" class="tag">#remote firewall instrumentation</a>
      
    </div>
  

  <nav class="post-navigation">
    
      <a href="/2022/08/15/Process-behaviour-anomaly-detection-using-eBPF-and-unsupervised-learning-Autoencoders/" class="nav-prev">
        <span class="nav-label">PREVIOUS</span>
        <span class="nav-title">Process Behaviour Anomaly Detection Using eBPF and Unsupervised-Learning Autoencoders</span>
      </a>
    
    
      <a href="/2020/05/26/Just-taking-a-break/" class="nav-next">
        <span class="nav-label">NEXT</span>
        <span class="nav-title">Just Taking a Break :D</span>
      </a>
    
  </nav>
</article>


  


<section class="related-posts">
  <h3 class="related-title">YOU MIGHT ALSO LIKE...</h3>
  <div class="cards-grid cards-grid-related">
    
      

<article class="card card-light">
  <a href="/2018/03/14/Go-is-amazing-so-here-s-what-i-don-t-like-about-it/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://abs.twimg.com/emoji/v2/72x72/1f984.png')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">go</span>
        
        <h2 class="card-title">Go Is Amazing, So Here&#39;s What I Don&#39;t Like About It</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2018/02/27/All-hail-bettercap-2-0-one-tool-to-rule-them-all/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://www.bettercap.org/img/logo.png')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">bettercap</span>
            
            <h2 class="card-title">All Hail Bettercap 2.0, One Tool to Rule Them All.</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-overlay">
  <a href="/2017/12/07/DIY-Portable-Secrets-Manager-with-a-RPI-Zero-and-the-ARC-Project/" class="card-link">
    
      <div class="card-image" style="background-image: url('https://i.imgur.com/NvLlafA.png')">
        
          <div class="card-overlay-content">
            
              <span class="card-category">go</span>
            
            <h2 class="card-title">DIY Portable Secrets Manager With a Raspberry Pi Zero and ARC</h2>
            <span class="card-read-more">READ MORE</span>
          </div>
        
      </div>
    
    
    
  </a>
</article>

    
      

<article class="card card-light">
  <a href="/2016/09/15/WiFi-Pineapple-NANO-OS-X-and-BetterCap-setup/" class="card-link">
    
      <div class="card-image" style="background-image: url('/images/2016/09/nano.jpg')">
        
      </div>
    
    
    
      <div class="card-content">
        
          <span class="card-category">bettercap</span>
        
        <h2 class="card-title">WiFi Pentesting With a Pineapple NANO, OS X and BetterCap</h2>
        
        <div class="card-footer">
          <span class="card-read-more">READ MORE</span>
        </div>
      </div>
    
  </a>
</article>

    
  </div>
</section>




  </main>
  
  <footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-social">
      
        
          
            <a href="https://github.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
        
          
            <a href="https://twitter.com/evilsocket" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
          
        
          
            <a href="http://it.linkedin.com/in/simonemargaritelli/" class="social-link" target="_blank" rel="noopener" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          
        
          
        
          
            <a href="mailto:evilsocket@gmail.com" class="social-link" aria-label="Email">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </a>
          
        
      
    </div>
    <p class="footer-copyright">
      &copy; 2025 evilsocket. 
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>.
    </p>
  </div>
</footer>

  <!-- Minimal JS - no external dependencies needed -->
<script>
  // Lazy load images
  document.addEventListener('DOMContentLoaded', function() {
    var images = document.querySelectorAll('.card-image[data-bg]');
    images.forEach(function(img) {
      img.style.backgroundImage = 'url(' + img.dataset.bg + ')';
    });
  });
</script>

</body>
</html>
